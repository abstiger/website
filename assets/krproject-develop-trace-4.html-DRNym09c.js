import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,o as e}from"./app-CdpNCDY8.js";const l={};function t(h,i){return e(),a("div",null,[...i[0]||(i[0]=[n(`<p>很久没有写博客了，国庆结束后将代码简单整理了一下，放到<a href="https://github.com/abstiger/krproject" title="krproject" target="_blank" rel="noopener noreferrer">github</a>上了，其实犹豫了很久，一方面我还是知道自己coding水平的，写的鸟代码可能会被人鄙视；另一方面，对于一个追求完美的人来说，这个版本确实还是太粗糙了。whatever……，我还是觉得有必要厚着脸皮将这第一步迈出去~</p><p>目前为止这个项目还是纯代码，并没有多少的文字介绍，花了一些时间整理了一个项目介绍的ppt：<a href="./assets/krproject-introduction.pptx">krproject-introduction</a></p><p>从上一篇 <a href="./krproject-develop-trace-3">krproject-develop-trace-3</a> 到现在已经有四个多月的时间了，其实这中间真正用来折腾krproject的时间并不是很多，不过还是做了些事情的:</p><h2 id="rapodbc" tabindex="-1"><a class="header-anchor" href="#rapodbc"><span>rapodbc</span></a></h2><p>前段时间想要给krproject增加数据库支持，主要是指mysql和sqlite，并考虑用sqlite3作为krproject的默认数据库引擎，一方面想方便试玩，另一方面会觉得这两个的适用场景可能更广泛些~</p><p>可是之前的数据库操作层是对嵌入式SQL（<a href="http://en.wikipedia.org/wiki/Embedded_SQL" title="Embedded SQL" target="_blank" rel="noopener noreferrer">Embedded SQL</a>）的一层包装：写数据库操作语句sql，gensql工具程序自动生成对应数据库操作的ESQL代码，再通过数据库提供的预编译工具将ESQL代码转化为c代码。一些主流的商业数据库管理系统像oracle、db2都有提供对应的预编译工具，而mysql和sqlite则不提供ESQL的支持。关于ESQL和ODBC的区别和对比，在上面的wiki链接里有更详细些的描述。</p><p>于是很自然的联想到更底层、更宽泛一点的标准：<a href="http://en.wikipedia.org/wiki/Odbc" title="wiki:odbc" target="_blank" rel="noopener noreferrer">odbc</a>，以前在学校的时候倒是被老师教过如何在windows里配置odbc数据源，那unix下也有对应的driver manger：<a href="http://www.unixodbc.org/" title="unixODBC" target="_blank" rel="noopener noreferrer">unixODBC</a> 和 <a href="http://www.iodbc.org" title="iodbc" target="_blank" rel="noopener noreferrer">iodbc</a>，有很多的linux发行版都带了unixODBC包，或者有提供对应安装rpm或deb包，所以我就很快选择unixODBC了，也没有详细对比这两个区别了，想要深度了解的同学可以顺着链接进去看下，这里就不展开了~另外不得不说，<a href="http://msdn.microsoft.com/en-us/library/ms710252(v=vs.85).aspx" title="msdn:odbc" target="_blank" rel="noopener noreferrer">msdn</a>上的odbc文档还是相当不错的！</p><p>然后便花了点时间写了个小工具：<a href="https://github.com/abstiger/rapodbc" title="rapodbc" target="_blank" rel="noopener noreferrer">rapodbc</a>（rap其实是取wrapper的谐音啦，你非要理解成rap也可以啦，哈哈~）</p><p>它的主要功能是对odbc操作做个封装，开发人员只要写sql，它就能将sql转化成对应的odbc操作C函数，然后依靠odbc的标准化和对应dbms的odbc driver便可以实现操作的数据库无关性~</p><p>比如，你有这样一张表：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> KR_TBL_SET_CFG</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   SET_ID               </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">INTEGER</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ELEMENT_VALUE        </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)           </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">   ELEMENT_DESC         </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">VARCHAR</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)           </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">not null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">   constraint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> P_PK_TBL_SET_ELEME </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">primary key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (SET_ID, ELEMENT_VALUE)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和一个类似这样的sql操作配置文件（t_dbs202_set_cfg_cur.cfg）：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">ELEMENT_VALUE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">ELEMENT_DESC</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">kr_tbl_set_cfg A</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">A</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">SET_ID</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:SET_ID#long#</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行 rapodbc （rapodbc t_dbs202_set_cfg_cur）后，便会得到这样两个文件：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxrwxrwx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  811</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 11月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:51</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set_cfg_cur.h</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxrwxrwx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2411</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 11月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 12:51</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> t_dbs202_set_cfg_cur.c</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>头文件和c文件中便包含了SQL想要完成的相关操作：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#ifndef __SetCfgCur_H__</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#define __SetCfgCur_H__</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">typedef</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    long</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        lInSetId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    char</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        caOutElementValue[200+1]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    char</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        caOutElementDesc[200+1]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}T_SetCfgCur;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dbsSetCfgCur</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">T_DbsEnv</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dbsenv,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> int</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> iFuncCode,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> T_SetCfgCur</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ptSetCfgCur</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">void</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dbsSetCfgCurInit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">T_SetCfgCur</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ptSetCfgCur</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>TIPS:SQL配置文件名的后四位决定生成的sql操作类型（_cur:cursor; _sel:select; _upd:update; _ins:insert; _del:delete）</p></blockquote><p>最新的unixODBC版本是2011年11月28号发布的2.3.1，而我的unixodbc版本则是在ubuntu里直接apt-get拿到的：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/home/tiger/Share/git/rapodbc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">isql</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">unixODBC</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2.2.14</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>对应的sqlite的odbc driver则是在<a href="http://www.ch-werner.de/sqliteodbc/" title="sqlite odbc driver" target="_blank" rel="noopener noreferrer">这里</a>下的安装包，自己编译安装的，版本为0.98</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/local/lib</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">l</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sqlite</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxr-xr-x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 434449</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 09:19</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libsqlite3odbc.so</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxr-xr-x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 434449</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 09:19</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libsqlite3odbc-0.98.so</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rwxr-xr-x</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    897</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 09:19</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libsqlite3odbc.la</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">-rw-r--r--</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 594430</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10月</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 09:19</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libsqlite3odbc.a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我的odbcinst.ini配置如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/etc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> odbcinst.ini</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[DB2]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Description</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DB2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ODBC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Driver</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Driver</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		    =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/ibm/db2/V9.7/lib64/libdb2.so</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">DontDLCLose</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Threading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FileUsage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[SQLite3]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Description</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SQLite3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ODBC</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Driver</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Driver</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">          =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/lib/libsqlite3odbc.so</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Setup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/lib/libsqlite3odbc.so</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Threading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>odbc.ini配置如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/home/tiger</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .odbc.ini</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[aicdb]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Description</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DB2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> datasource</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aicdb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Driver</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DB2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[mysqlite3db]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Description</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> My</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SQLite</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> database</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Driver</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SQLite3</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Database</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/tiger/mysqlite3.db</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># optional lock timeout in milliseconds</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为这一块相对独立，而且个人觉得也还蛮有用的，便将代码已经放到<a href="https://github.com/abstiger/rapodbc" title="rapodbc" target="_blank" rel="noopener noreferrer">github</a>上作为独立工具项目开源了</p><h2 id="回顾一下" tabindex="-1"><a class="header-anchor" href="#回顾一下"><span>回顾一下</span></a></h2><ul><li>增加历史统计量LRU缓存功能，krproject的大部分统计运算是基于内存存储krdb的，而对于行为习惯等时间跨度较长的统计量、特征值则需要从数据库中获取，为了减少数据库的操作次数，会对这些数据做缓存，缓存的大小可配置；</li><li>为了提供接口，将引擎封装到krengine中，对外部仅暴露三个主要接口函数：kr_engine_startup()，kr_engine_run()，kr_engine_shutdown()；</li><li>编写了Python的接口，结合pika库实现了和rabbitmq通信的功能；</li><li>增加了动态库加载功能（kr_module,只是简单包装了posix的dl功能），将krdb的接口转换纳入模块加载中，用户可自己编写接口数据到krdb内存的转换模块了。</li></ul><h2 id="后续计划" tabindex="-1"><a class="header-anchor" href="#后续计划"><span>后续计划</span></a></h2><ul><li>压力测试，这个也许是当前最要紧的了，想尽快补充引擎的benchmark图，虽然对引擎的性能很有信心，但是没有实践没有发言权；</li><li>tutorial及样例的编写，学着写文档；</li><li>增加数据库的支持，目前只支持db2和oracle，考虑增加mysql和sqlite的支持，并考虑将sqlite3做为默认数据库支持，方便试玩；</li><li>处理的应答回调函数处理模块设计编写；</li><li>规则及统计量的配置界面（考虑用Python实现，这块感觉自己一个人还是够呛，没有前台开发经验……）。</li></ul>`,31)])])}const r=s(l,[["render",t]]),d=JSON.parse(`{"path":"/projects/krproject/krproject-develop-trace-4.html","title":"krproject开发进展（四）","lang":"zh-CN","frontmatter":{"order":4,"title":"krproject开发进展（四）","article":false,"date":"2012-10-20T15:43:32.000Z","description":"很久没有写博客了，国庆结束后将代码简单整理了一下，放到github上了，其实犹豫了很久，一方面我还是知道自己coding水平的，写的鸟代码可能会被人鄙视；另一方面，对于一个追求完美的人来说，这个版本确实还是太粗糙了。whatever……，我还是觉得有必要厚着脸皮将这第一步迈出去~ 目前为止这个项目还是纯代码，并没有多少的文字介绍，花了一些时间整理了一个...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"krproject开发进展（四）\\",\\"description\\":\\"很久没有写博客了，国庆结束后将代码简单整理了一下，放到github上了，其实犹豫了很久，一方面我还是知道自己coding水平的，写的鸟代码可能会被人鄙视；另一方面，对于一个追求完美的人来说，这个版本确实还是太粗糙了。whatever……，我还是觉得有必要厚着脸皮将这第一步迈出去~ 目前为止这个项目还是纯代码，并没有多少的文字介绍，花了一些时间整理了一个...\\"}"],["meta",{"property":"og:url","content":"https://abstiger.com/projects/krproject/krproject-develop-trace-4.html"}],["meta",{"property":"og:site_name","content":"Tiger's Website"}],["meta",{"property":"og:title","content":"krproject开发进展（四）"}],["meta",{"property":"og:description","content":"很久没有写博客了，国庆结束后将代码简单整理了一下，放到github上了，其实犹豫了很久，一方面我还是知道自己coding水平的，写的鸟代码可能会被人鄙视；另一方面，对于一个追求完美的人来说，这个版本确实还是太粗糙了。whatever……，我还是觉得有必要厚着脸皮将这第一步迈出去~ 目前为止这个项目还是纯代码，并没有多少的文字介绍，花了一些时间整理了一个..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-15T10:21:25.000Z"}],["meta",{"property":"article:published_time","content":"2012-10-20T15:43:32.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-15T10:21:25.000Z"}]]},"git":{"createdTime":1763202085000,"updatedTime":1763202085000,"contributors":[{"name":"mingqiang.cheng","username":"","email":"mingqiang.cheng@cloudpense.com","commits":1}]},"readingTime":{"minutes":5.09,"words":1527},"filePathRelative":"projects/krproject/krproject-develop-trace-4.md","excerpt":"<p>很久没有写博客了，国庆结束后将代码简单整理了一下，放到<a href=\\"https://github.com/abstiger/krproject\\" title=\\"krproject\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">github</a>上了，其实犹豫了很久，一方面我还是知道自己coding水平的，写的鸟代码可能会被人鄙视；另一方面，对于一个追求完美的人来说，这个版本确实还是太粗糙了。whatever……，我还是觉得有必要厚着脸皮将这第一步迈出去~</p>\\n<p>目前为止这个项目还是纯代码，并没有多少的文字介绍，花了一些时间整理了一个项目介绍的ppt：<a href=\\"./assets/krproject-introduction.pptx\\">krproject-introduction</a></p>","autoDesc":true}`);export{r as comp,d as data};
