import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as n,o as e}from"./app-CdpNCDY8.js";const l={};function h(t,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="极客家居-路由网关" tabindex="-1"><a class="header-anchor" href="#极客家居-路由网关"><span>极客家居-路由网关</span></a></h1><p>基于 OpenWRT 构建的路由网关</p><h2 id="原理背景" tabindex="-1"><a class="header-anchor" href="#原理背景"><span>原理背景</span></a></h2><h3 id="防火墙相关" tabindex="-1"><a class="header-anchor" href="#防火墙相关"><span>防火墙相关</span></a></h3><ul><li>netfilter/iptables简介 https://segmentfault.com/a/1190000009043962</li><li>iptables详解 https://www.xiebruce.top/1071.html</li></ul><h3 id="抓包分析" tabindex="-1"><a class="header-anchor" href="#抓包分析"><span>抓包分析</span></a></h3><ul><li>tcpdump https://www.tcpdump.org/ 基于cBPF增加了语法解析，命令行直接抓包</li><li>wireshark https://www.wireshark.org/ 增加了GUI，更直观方便的学习了解网络处理</li></ul><h2 id="安装配置" tabindex="-1"><a class="header-anchor" href="#安装配置"><span>安装配置</span></a></h2><p>https://www.cnblogs.com/Magiclala/p/18418732</p><h3 id="操作系统" tabindex="-1"><a class="header-anchor" href="#操作系统"><span>操作系统</span></a></h3><p>操作系统采用 <a href="https://openwrt.org" target="_blank" rel="noopener noreferrer">OpenWrt</a></p><ul><li>官方文档 https://openwrt.org/docs/start</li><li>用户指南 https://openwrt.org/docs/guide-user/start</li></ul><h4 id="安装引导固件breed" tabindex="-1"><a class="header-anchor" href="#安装引导固件breed"><span>安装引导固件Breed</span></a></h4><p>https://openwrt.org/docs/techref/bootloader/breed</p><h4 id="使用开源固件" tabindex="-1"><a class="header-anchor" href="#使用开源固件"><span>使用开源固件</span></a></h4><p>https://op.supes.top/firmware/</p><p>https://github.com/kiddin9/OpenWrt_x86-r2s-r4s</p><h4 id="编译固件刷机-备选" tabindex="-1"><a class="header-anchor" href="#编译固件刷机-备选"><span>编译固件刷机（备选）</span></a></h4><p>基于 github actions 自编译固件</p><p>https://docs.github.com/en/actions</p><p>https://www.youtube.com/watch?v=R8_veQiYBjI</p><h3 id="配置动态域名" tabindex="-1"><a class="header-anchor" href="#配置动态域名"><span>配置动态域名</span></a></h3><p>家庭网络一般为动态变化的ip地址，为了能够访问到家里的网络，需要在检测到ip变化时，及时更新域名对应的ip地址，使得域名永远指向家庭的ip地址，此即为<a href="http://baike.baidu.com/view/762.htm" target="_blank" rel="noopener noreferrer">动态域名解析</a>。</p><ol><li>DDNS</li></ol><h3 id="配置流量入口" tabindex="-1"><a class="header-anchor" href="#配置流量入口"><span>配置流量入口</span></a></h3><h4 id="通过wireguard" tabindex="-1"><a class="header-anchor" href="#通过wireguard"><span>通过WireGuard</span></a></h4><ul><li>官方指南 https://openwrt.org/docs/guide-user/services/vpn/wireguard/start</li><li>OpenWRT WireGuard VPN Server Tutorial https://www.reddit.com/r/openwrt/comments/bahhua/openwrt_wireguard_vpn_server_tutorial/</li><li>使用WireGuard随时随地访问家中内网资源 https://www.right.com.cn/forum/thread-1335402-1-1.html</li><li>安装和配置wireguard https://segmentfault.com/a/1190000021720487</li></ul><h4 id="通过openvpn" tabindex="-1"><a class="header-anchor" href="#通过openvpn"><span>通过OpenVPN</span></a></h4><h3 id="配置流量出口" tabindex="-1"><a class="header-anchor" href="#配置流量出口"><span>配置流量出口</span></a></h3><ol><li>bypass</li></ol><h3 id="配置广告拦截" tabindex="-1"><a class="header-anchor" href="#配置广告拦截"><span>配置广告拦截</span></a></h3><ol><li>adbyby-plus</li></ol><h3 id="配置文件共享" tabindex="-1"><a class="header-anchor" href="#配置文件共享"><span>配置文件共享</span></a></h3><p>Samba，参考：</p><ul><li>https://ubuntu.com/server/docs/samba-introduction</li><li>https://help.ubuntu.com/community/Samba/SambaClientGuide</li><li>https://wiki.samba.org/index.php/LinuxCIFS_utils</li></ul><h4 id="服务端" tabindex="-1"><a class="header-anchor" href="#服务端"><span>服务端</span></a></h4><p>TODO</p><h4 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端"><span>客户端</span></a></h4><p>安装：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smbclient</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cifs-utils</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>测试：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">smbclient</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //gate.krproject.org/samba</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -U</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>挂载：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /samba</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mount</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cifs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username=root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //gate.krproject.org/samba</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /samba</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>持久挂载：</p><p>vi /root/.samba_credentials</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>username=root</span></span>
<span class="line"><span>password=******</span></span>
<span class="line"><span>domain=WORKGROUP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vi /etc/fstab</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>//gate.krproject.org/samba  /samba cifs credentials=/root/.samba_credentials 0 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mount</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">df</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -hT</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置域名证书" tabindex="-1"><a class="header-anchor" href="#配置域名证书"><span>配置域名证书</span></a></h3><p>基于 acme</p><p>全站 HTTPS 没你想象的那么简单 : https://www.cnblogs.com/mafly/p/allhttps.html</p><h4 id="服务端-1" tabindex="-1"><a class="header-anchor" href="#服务端-1"><span>服务端</span></a></h4><p>安装<code>luci-app-acme</code></p><p>编辑 <code>/etc/config/nginx</code></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>config main global</span></span>
<span class="line"><span>	option uci_enable &#39;true&#39;</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>config server &#39;_lan&#39;</span></span>
<span class="line"><span>	list listen &#39;80&#39;</span></span>
<span class="line"><span>	list listen &#39;[::]:80&#39;</span></span>
<span class="line"><span>	option return &#39;302 https://$host$request_uri&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>config server &#39;_ssl&#39;</span></span>
<span class="line"><span>	list listen &#39;443 ssl&#39;</span></span>
<span class="line"><span>	list listen &#39;[::]:443 ssl&#39;</span></span>
<span class="line"><span>	option server_name &#39;*.krproject.org&#39;</span></span>
<span class="line"><span>	list include &#39;conf.d/*.locations&#39;</span></span>
<span class="line"><span>	option ssl_certificate &#39;/mnt/sda3/acme/krproject.org/krproject.org.cer&#39;</span></span>
<span class="line"><span>	option ssl_certificate_key &#39;/mnt/sda3/acme/krproject.org/krproject.org.key&#39;</span></span>
<span class="line"><span>	option ssl_session_cache &#39;shared:SSL:32k&#39;</span></span>
<span class="line"><span>	option ssl_session_timeout &#39;64m&#39;</span></span>
<span class="line"><span>	option access_log &#39;off; # logd openwrt&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="客户端-1" tabindex="-1"><a class="header-anchor" href="#客户端-1"><span>客户端</span></a></h4><p>check-acme-files.sh</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">\${0}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_LIST_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &#39;/samba/acme/krproject.org/fullchain.cer /etc/ssl/krproject.org/fullchain.cer&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &#39;/samba/acme/krproject.org/krproject.org.cer /etc/ssl/krproject.org/krproject.org.cer&#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        &#39;/samba/acme/krproject.org/krproject.org.key /etc/ssl/krproject.org/krproject.org.key&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_CHANGED</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) : check files starting!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># check files changed or not</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">!</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_LIST_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[@]</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">do</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        FILE_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_LIST_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        SOURCE_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[0]</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        TARGET_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_ARRAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[1]</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SOURCE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) : </span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SOURCE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> not exists!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ! </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cmp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SOURCE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TARGET_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">                echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) : copy </span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SOURCE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to </span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TARGET_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">                cp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">SOURCE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TARGET_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                FILE_CHANGED</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        fi</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># restart apache2 when file changed</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FILE_CHANGED</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -eq</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">        echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) : service apache2 restart&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apache2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">) : check files finished!&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,61)])])}const r=i(l,[["render",h]]),d=JSON.parse(`{"path":"/projects/homelab/homelab-10-gate.html","title":"极客家居-路由网关","lang":"zh-CN","frontmatter":{"order":10,"title":"极客家居-路由网关","author":"abstiger","article":false,"description":"极客家居-路由网关 基于 OpenWRT 构建的路由网关 原理背景 防火墙相关 netfilter/iptables简介 https://segmentfault.com/a/1190000009043962 iptables详解 https://www.xiebruce.top/1071.html 抓包分析 tcpdump https://www.t...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"极客家居-路由网关\\",\\"description\\":\\"极客家居-路由网关 基于 OpenWRT 构建的路由网关 原理背景 防火墙相关 netfilter/iptables简介 https://segmentfault.com/a/1190000009043962 iptables详解 https://www.xiebruce.top/1071.html 抓包分析 tcpdump https://www.t...\\"}"],["meta",{"property":"og:url","content":"https://abstiger.com/projects/homelab/homelab-10-gate.html"}],["meta",{"property":"og:site_name","content":"Tiger's Website"}],["meta",{"property":"og:title","content":"极客家居-路由网关"}],["meta",{"property":"og:description","content":"极客家居-路由网关 基于 OpenWRT 构建的路由网关 原理背景 防火墙相关 netfilter/iptables简介 https://segmentfault.com/a/1190000009043962 iptables详解 https://www.xiebruce.top/1071.html 抓包分析 tcpdump https://www.t..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-15T10:21:25.000Z"}],["meta",{"property":"article:author","content":"abstiger"}],["meta",{"property":"article:modified_time","content":"2025-11-15T10:21:25.000Z"}]]},"git":{"createdTime":1763202085000,"updatedTime":1763202085000,"contributors":[{"name":"mingqiang.cheng","username":"","email":"mingqiang.cheng@cloudpense.com","commits":1}]},"readingTime":{"minutes":2.06,"words":617},"filePathRelative":"projects/homelab/homelab-10-gate.md","excerpt":"\\n<p>基于 OpenWRT 构建的路由网关</p>\\n<h2>原理背景</h2>\\n<h3>防火墙相关</h3>\\n<ul>\\n<li>netfilter/iptables简介 https://segmentfault.com/a/1190000009043962</li>\\n<li>iptables详解 https://www.xiebruce.top/1071.html</li>\\n</ul>\\n<h3>抓包分析</h3>\\n<ul>\\n<li>tcpdump https://www.tcpdump.org/  基于cBPF增加了语法解析，命令行直接抓包</li>\\n<li>wireshark  https://www.wireshark.org/  增加了GUI，更直观方便的学习了解网络处理</li>\\n</ul>","autoDesc":true}`);export{r as comp,d as data};
