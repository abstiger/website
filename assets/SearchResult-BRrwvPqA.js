import{g as V,u as W,h as X,i as Z,j as ee,t as te,k as re,l as L,m as H,n as e,p as le,q as ae,s as se,R as F,v as oe,x as ce,y as ie,z as ne,A as ue,B as I,C as T,D as pe,E as he,F as me,G as ve,L as de,H as je,I as ge,J as ye,K as U,M as ke,N as x}from"./app-CdpNCDY8.js";const be=["/","/about/","/blog/","/blog/exploring-openapi-security.html","/blog/hello-world.html","/blog/learning-hyperdex-1.html","/blog/learning-nanomsg-1.html","/blog/learning-nanomsg-2.html","/blog/learning-nanomsg-3.html","/blog/learning-rete.html","/blog/learning-sqlalchemy.html","/blog/playing-with-svm.html","/books/","/projects/","/books/jsjjc/10-ca.html","/books/jsjjc/11-ca-connect.html","/books/jsjjc/12-ca-storage.html","/books/jsjjc/13-ca-compute.html","/books/jsjjc/20-os.html","/books/jsjjc/21-os-client.html","/books/jsjjc/22-os-server.html","/books/jsjjc/30-network.html","/books/jsjjc/40-infra.html","/books/jsjjc/41-infra-virtualization.html","/books/jsjjc/42-infra-containerization.html","/books/jsjjc/","/books/jsjjc/overview.html","/projects/homelab/","/projects/homelab/homelab-10-gate.html","/projects/homelab/homelab-20-data.html","/projects/homelab/homelab-30-conn.html","/projects/krproject/","/projects/krproject/krproject-develop-trace-1.html","/projects/krproject/krproject-develop-trace-10.html","/projects/krproject/krproject-develop-trace-11.html","/projects/krproject/krproject-develop-trace-12.html","/projects/krproject/krproject-develop-trace-13.html","/projects/krproject/krproject-develop-trace-14.html","/projects/krproject/krproject-develop-trace-15.html","/projects/krproject/krproject-develop-trace-2.html","/projects/krproject/krproject-develop-trace-3.html","/projects/krproject/krproject-develop-trace-4.html","/projects/krproject/krproject-develop-trace-5.html","/projects/krproject/krproject-develop-trace-6.html","/projects/krproject/krproject-develop-trace-7.html","/projects/krproject/krproject-develop-trace-8.html","/projects/krproject/krproject-develop-trace-9.html","/404.html","/category/","/category/exploring/","/category/learning/","/category/playing/","/tag/","/tag/openapi/","/tag/security/","/tag/restful/","/tag/gateful/","/tag/welcome/","/tag/hyperdex/","/tag/hyperspacehashing/","/tag/nosql/","/tag/nanomsg/","/tag/c/","/tag/rete/","/tag/rule/","/tag/drools/","/tag/python/","/tag/sqlalchemy/","/tag/orm/","/tag/machine-learning/","/tag/svm/","/article/","/star/","/timeline/"],fe="SLIMSEARCH_QUERY_HISTORY",g=U(fe,[]),He=()=>{const{queryHistoryCount:a}=x;return{enabled:a>0,queryHistories:g,addQueryHistory:i=>{g.value=Array.from(new Set([i,...g.value.slice(0,a-1)]))},removeQueryHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}},D=a=>be[a.id]+("anchor"in a?`#${a.anchor}`:""),xe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=x,y=U(xe,[]),we=()=>({enabled:M>0,resultHistories:y,addResultHistory:c=>{{const i={link:D(c),display:c.display};"header"in c&&(i.header=c.header),y.value=[i,...y.value.slice(0,M-1)]}},removeResultHistory:c=>{y.value=[...y.value.slice(0,c),...y.value.slice(c+1)]}}),qe=a=>{const{page:c,routeLocale:i}=pe(),w=he(),s=L(0),k=H(()=>s.value>0),p=me([]);return ve(()=>{const{search:q,terminate:v}=de(),b=ge(d=>{const{resultsFilter:R=l=>l,querySplitter:j,suggestionsFilter:$,...o}=w.value;d?(s.value+=1,q(d,i.value,o).then(l=>R(l,d,i.value,c.value)).then(l=>{s.value-=1,p.value=l}).catch(l=>{console.warn(l),s.value-=1,s.value||(p.value=[])})):p.value=[]},x.searchDelay-x.suggestDelay,{maxWait:5e3});je([a,i],([d])=>b(d.join(" "))),ye(()=>{v()})}),{isSearching:k,results:p}};var Qe=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:c}){const i=W(),w=X(),s=Z(ee),{addQueryHistory:k,queryHistories:p,removeQueryHistory:q}=He(),{resultHistories:v,addResultHistory:b,removeResultHistory:d}=we(),R=te(a,"queries"),{results:j,isSearching:$}=qe(R),o=re({isQuery:!0,index:0}),l=L(0),h=L(0),A=H(()=>p.value.length>0||v.value.length>0),Q=H(()=>j.value.length>0),S=H(()=>j.value[l.value]||null),_=()=>{const{isQuery:t,index:r}=o;r===0?(o.isQuery=!t,o.index=t?v.value.length-1:p.value.length-1):o.index=r-1},z=()=>{const{isQuery:t,index:r}=o;r===(t?p.value.length-1:v.value.length-1)?(o.isQuery=!t,o.index=0):o.index=r+1},O=()=>{l.value=l.value>0?l.value-1:j.value.length-1,h.value=S.value.contents.length-1},P=()=>{l.value=l.value<j.value.length-1?l.value+1:0,h.value=0},Y=()=>{h.value<S.value.contents.length-1?h.value+=1:P()},B=()=>{h.value>0?h.value-=1:O()},C=t=>t.map(r=>ke(r)?r:e(r[0],r[1])),G=t=>{if(t.type==="customField"){const r=ne[t.index]||"$content",[m,n=""]=ue(r)?r[w.value].split("$content"):r.split("$content");return t.display.map(u=>e("div",C([m,...u,n])))}return t.display.map(r=>e("div",C(r)))},f=()=>{l.value=0,h.value=0,c("updateQuery",""),c("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},s.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},p.value.map((t,r)=>{const m=o.isQuery&&o.index===r;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{c("updateQuery",t)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},t),e("button",{type:"button",class:"slimsearch-remove-icon",title:s.value.remove,"aria-label":s.value.remove,innerHTML:T,onClick:n=>{n.preventDefault(),n.stopPropagation(),q(r)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},s.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((t,r)=>{const m=!o.isQuery&&o.index===r;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(F,{to:t.link,onClick:()=>{f()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[t.header?e("div",{class:"slimsearch-record-content-header"},t.header):null,e("div",t.display.map(n=>C(n)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:s.value.remove,"aria-label":s.value.remove,innerHTML:T,onClick:n=>{n.preventDefault(),n.stopPropagation(),d(r)}})]))}))]));return le("keydown",t=>{if(a.isFocusing){if(Q.value){if(t.key==="ArrowUp")B();else if(t.key==="ArrowDown")Y();else if(t.key==="Enter"){const r=S.value.contents[h.value];k(a.queries.join(" ")),b(r),i.push(D(r)),f()}}else if(t.key==="ArrowUp")_();else if(t.key==="ArrowDown")z();else if(t.key==="Enter"){const{index:r}=o;o.isQuery?(t.preventDefault(),c("updateQuery",p.value[r])):(i.push(v.value[r].link),f())}}}),ae([l,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:a.queries.length?!Q.value:!A.value}]},a.queries.length?$.value?e(se,{hint:s.value.searching}):Q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},j.value.map(({title:t,contents:r},m)=>{const n=l.value===m;return e("div",{class:["slimsearch-record",{active:n}],role:"group","aria-selected":n},[e("div",{class:"slimsearch-record-title"},t||s.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},r.map((u,N)=>{const E=n&&h.value===N;return e("li",{class:["slimsearch-record-matches",{active:E}],role:"option","aria-selected":E},e(F,{to:D(u),onClick:()=>{k(a.queries.join(" ")),b(u),f()}},()=>[u.type==="text"?null:e(u.type==="title"?oe:u.type==="heading"?ce:ie,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[u.type==="text"&&u.header?e("div",{class:"slimsearch-record-content-header"},u.header):null,e("div",G(u))])]))}))])})):s.value.emptyResult:A.value?[J(),K()]:s.value.emptyHistory)}});export{Qe as default};
